---
title: "ã€Arduinoã€‘ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹"
emoji: "ğŸ¤–"
type: "tech"
topics: []
published: false
---

ArduinoåŒå£«ã€ã‚‚ã—ãã¯Arduinoã¨PCã®é–“ã§ã€è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹æ–¹æ³•ï¼ˆè‡ªå·±æµï¼‰ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚  
  
* [1.æ–¹æ³•](#1æ–¹æ³•)
* [2.ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ](#2ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ )
* [ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ç¬¬äºŒæ®µ](#ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ç¬¬äºŒæ®µ)

### 1.æ–¹æ³•

ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ãŒä¸€ã¤ã®å ´åˆ

Serial.write(data);  //é€ä¿¡å´
data = Serial.read()  //å—ä¿¡å´

ã®ã‚ˆã†ã«æ›¸ã‘ã°ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ãŒè¤‡æ•°ã«ãªã‚‹ã¨ã€é€ã‚‰ã‚Œã¦ããŸãƒ‡ãƒ¼ã‚¿ãŒä½•ã‚’è¡¨ã—ã¦ã„ã‚‹ã®ã‹ãŒåˆ†ã‹ã‚‰ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®å€¤ã¨ã‚¸ãƒ£ã‚¤ãƒ­ã‚»ãƒ³ã‚µãƒ¼ã®å€¤ã¨ã„ã†äºŒã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹ã¨ãã€åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã¦ã‚‚ã€ãã‚Œã‚’ã‚¸ãƒ£ã‚¤ãƒ­ã‚»ãƒ³ã‚µãƒ¼ã®å€¤ã¨èª¤è§£ã—ã¦ã—ã¾ã„ã€é–“é•ã£ãŸå‡¦ç†ã‚’ã—ã¦ã—ã¾ã†ã€ã¨ã„ã†ã“ã¨ã‚‚è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ãã“ã§ã€ãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã‚’é€ã‚‹å‰ã«ã€ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ï¼ˆä»Šã‹ã‚‰é€ã‚‰ã‚Œã¦ãã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã€åŠ é€Ÿåº¦ã‚’è¡¨ã™ã®ã‹ã‚¸ãƒ£ã‚¤ãƒ­ã‚’è¡¨ã™ã®ã‹ï¼‰ã‚’é€ä¿¡ã™ã‚Œã°ã„ã„ã®ã§ã¯ãªã„ã‹ï¼Ÿã¨è€ƒãˆã¾ã—ãŸã€‚  
  
  
### 2.ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ 

ã“ã®è¨˜äº‹ã®ä¸€ç•ªä¸‹ã«è¼‰ã›ã¦ã„ã¾ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ã€é€ä¿¡ã¨å—ä¿¡ä¸¡æ–¹ã§ãã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚  
é€ä¿¡ç”¨é–¢æ•°ã¯ã€ŒSend\_Data()ã€ã€å—ä¿¡ç”¨ã®é–¢æ•°ã¯ã€ŒserialEvent()ã€ã§ã™ã€‚

ãƒ‡ãƒ¼ã‚¿é€å—ä¿¡ã®å½¢å¼ã¯ã€

> **ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡) , (ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ï¼‰\\n**

ã§ã™ã€‚

serialEvent() å†…ã® 

myString = readStringUntil("\n")

ã¯ã€é€ã‚‰ã‚Œã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’ "\\n"ï¼ˆæ”¹è¡Œï¼‰ã¾ã§å—ä¿¡ã—ç¶šã‘ã‚‹é–¢æ•°ã§ã™ã€‚ãã—ã¦ã€æˆ»ã‚Šå€¤ã¯å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ãªã®ã§ã€myString ã«ã¯

> **ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡) , (ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ï¼‰\\n**

ã®å½¢ã§ãƒ‡ãƒ¼ã‚¿ãŒä»£å…¥ã•ã‚Œã¾ã™ã€‚

ãã—ã¦ã€ãã‚Œã‚’splité–¢æ•°ã§ã€ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ã¨ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ã«åˆ†ã‘ã€é©åˆ‡ãªå¤‰æ•°ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ã“ã¨ã§ã€ãƒ‡ãƒ¼ã‚¿å—ä¿¡å®Œäº†ã€ã¨ã„ã†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚

splité–¢æ•°ã¯ã€æ–‡å­—åˆ—ã‚’ç‰¹å®šã®æ–‡å­—ï¼ˆä»¥ä¸‹ã®å ´åˆã¯â€, "ï¼‰ã§åŒºåˆ‡ã‚‹é–¢æ•°ã§ã™ãŒã€Arduino IDE ã«ã¯splité–¢æ•°ãŒãªã„ã®ã§ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‚’å‚è€ƒã«ã—ã¦splité–¢æ•°ã‚’ä½œæˆã—ã¾ã—ãŸã€‚  
[ã€Arduinoã€‘æ–‡å­—åˆ—ã‚’åŒºåˆ‡ã‚Šæ–‡å­—ã§åˆ†å‰²(splité–¢æ•°) | ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é›‘è¨˜](https://algorithm.joho.info/arduino/string-split-delimiter/)

  
#define GYRO_X 1
#define GYRO_Y 2
#define GYRO_Z 3

// #define ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ å®šæ•°ã€€ã¨ã„ã†å½¢ã§ã€ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡ã‚’å®šç¾©ã—ã¦ã„ãã¾ã™ã€‚

float cmds[2];// åˆ†å‰²ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’æ ¼ç´ã™ã‚‹é…åˆ— 

float Gyro_X = 0;  //å—ä¿¡ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã«æ ¼ç´ã•ã‚Œã¾ã™ã€‚
float Gyro_Y = 0;
float Gyro_Z = 0;

void setup(){
  Serial.begin(115200);
}

void loop(){
  //ã“ã®ã‚ˆã†ã«ã€SendData(ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡(å®šæ•°ï¼‰, ãƒ‡ãƒ¼ã‚¿æœ¬ä½“ï¼‰ã§ã€ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
  //é€ä¿¡ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ã€ä¸€å›ã«ã¤ã1ãƒã‚¤ãƒˆã§ã™ã€‚
  SendData(GYRO_Y, Gyro_Y);   
  delay(50);
}

void SendData(int kind, float data){  
  //ãƒ‡ãƒ¼ã‚¿ä¸€ã¤ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°ã§ã™
  Serial.print(kind);
  Serial.print(","); 
  Serial.print(int(data));
  Serial.println("\n");
}

int split(String data, char delimiter, float *dst){
    int index = 0;
    int arraySize = (sizeof(data)/sizeof((data)[0]));  
    int datalength = data.length();
    for (int i = 0; i < datalength; i++) {
        char tmp = data.charAt(i);
        if ( tmp == delimiter ) {
            index++;
            if ( index > (arraySize - 1)) return -1;
        }
        else dst[index] += float(tmp);
    }
    return (index + 1);
}

void serialEvent(){
  //ãƒ‡ãƒ¼ã‚¿ã‚’1ã¤å—ä¿¡ã™ã‚‹é–¢æ•°ï¼ˆå‰²ã‚Šè¾¼ã¿å‡¦ç†ï¼‰ã§ã™ã€‚
  String myString = Serial.readStringUntil('\n');
  int index = split(myString, ',', cmds);
  if(Serial.available() >= 2){ 
     switch(int(cmds[0])){
       case GYRO_X:
       Gyro_X = float(cmds[1]);
       break;

       case GYRO_Y:
         Gyro_Y = float(cmds[1]);
       break;
             
       case GYRO_Z:
         Gyro_Z = float(cmds[1]);
       break;
           
     }
  }
}
  
  
### ã‚·ãƒªã‚¢ãƒ«é€šä¿¡ã§è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€å—ä¿¡ã™ã‚‹ç¬¬äºŒæ®µ

[shizenkarasuzon.hatenablog.com](https://shizenkarasuzon.hatenablog.com/entry/2018/09/21/024721)